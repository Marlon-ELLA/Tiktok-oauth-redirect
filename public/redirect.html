<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Redirecci√≥n TikTok - PanGabrielWeb</title>
  <style>
    body { font-family: Arial; background: #fafafa; text-align:center; padding:50px; }
    .card { background:white; padding:30px; border-radius:8px; max-width:600px; margin:auto; box-shadow:0 2px 8px rgba(0,0,0,0.1);}
    code { background:#eee; padding:10px; display:block; margin:20px 0; word-break: break-all; }
    .btn { background:#fe2c55; color:white; padding:10px 20px; border-radius:5px; text-decoration:none; }
  </style>
</head>
<body>
  <div class="card">
    <h1>¬°Login con TikTok exitoso üéâ!</h1>
    <div id="result">
      <p>Procesando autorizaci√≥n...</p>
    </div>
    <a href="index.html" class="btn">Volver al inicio</a>
  </div>
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const code = urlParams.get("code");
    const resultDiv = document.getElementById("result");

    if (!code) {
      resultDiv.innerHTML = '<p>‚ö†Ô∏è No se encontr√≥ ning√∫n c√≥digo de autorizaci√≥n.</p>';
    } else {
      // Enviar el code al backend para obtener el access_token
      fetch("https://tiktok-oauth-redirect.vercel.app/api/exchange-code", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ code })
      })
      .then(res => res.json())
      .then(data => {
        if (data.data && data.data.access_token) {
          resultDiv.innerHTML = `
            <p><strong>Access Token:</strong></p>
            <code>${data.data.access_token}</code>
            <p><strong>Refresh Token:</strong></p>
            <code>${data.data.refresh_token}</code>
            <p><strong>Open ID:</strong></p>
            <code>${data.data.open_id}</code>
            <p>Guarda estos datos para futuras consultas.</p>
          `;
        } else if (data.error) {
          resultDiv.innerHTML = `<p>‚ùå Error: ${JSON.stringify(data.error)}</p>`;
        } else {
          resultDiv.innerHTML = `<p>‚ùå Error inesperado: ${JSON.stringify(data)}</p>`;
        }
      })
      .catch(err => {
        resultDiv.innerHTML = `<p>‚ùå Error de red: ${err.message}</p>`;
      });
    }
  </script>
</body>
</html>
